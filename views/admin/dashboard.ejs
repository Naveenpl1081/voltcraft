<%- include('../layouts/adminHeader') %>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<h1>Welcome to Dashboard</h1>

<section class="content-main">
    <div class="content-header">
        <div>
            <p>Whole data about your business here</p>
        </div>
        <div class="time-filter">
            <select id="timeRangeSelector" class="form-select">
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
                <option value="yearly">Yearly</option>
            </select>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row">
        <!-- Revenue Card -->
        <div class="col-lg-3">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-primary-light">
                        <i class="text-primary material-icons md-monetization_on"></i>
                    </span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Revenue</h6>
                        <span>₹<%= totalRevenue.toLocaleString('en-IN') %></span>
                        <span class="text-sm">Total Revenue</span>
                    </div>
                </article>
            </div>
        </div>

        <!-- Current Period Revenue -->
        <div class="col-lg-3">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-success-light">
                        <i class="text-success material-icons md-account_balance_wallet"></i>
                    </span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Current Period Revenue</h6>
                        <span id="currentPeriodRevenue">₹0</span>
                        <span id="periodLabel" class="text-sm">Select a time period</span>
                    </div>
                </article>
            </div>
        </div>

        <!-- Orders -->
        <div class="col-lg-3">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-warning-light">
                        <i class="text-warning material-icons md-local_shipping"></i>
                    </span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Orders</h6>
                        <span id="currentPeriodOrders">0</span>
                        <span class="text-sm">In current period</span>
                    </div>
                </article>
            </div>
        </div>

        <!-- Items Sold -->
        <div class="col-lg-3">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-info-light">
                        <i class="text-info material-icons md-shopping_basket"></i>
                    </span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Items Sold</h6>
                        <span id="currentPeriodItems">0</span>
                        <span class="text-sm">In current period</span>
                    </div>
                </article>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="row">
        <!-- Category Distribution Chart -->
        <div class="col-xl-6 col-lg-12">
            <div class="card mb-4">
                <article class="card-body">
                    <h5 class="card-title">Sales by Category</h5>
                    <div id="categoryChart"></div>
                </article>
            </div>
        </div>

        <!-- Time Series Chart -->
        <div class="col-xl-6 col-lg-12">
            <div class="card mb-4">
                <article class="card-body">
                    <h5 class="card-title">Revenue Over Time</h5>
                    <div id="timeSeriesChart"></div>
                </article>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Initialize data from server
    const timeBasedData = <%- JSON.stringify(timeBasedData) %>;
    const currentPeriod = <%- JSON.stringify(currentPeriod) %>;
    const chartLabels = <%- JSON.stringify(chartLabels) %>;
    const chartData = <%- JSON.stringify(chartData) %>;

    // Category Distribution Chart
    const categoryOptions = {
        series: chartData,
        chart: {
            height: 400,
            type: 'pie'
        },
        labels: chartLabels,
        colors: ['#008FFB', '#00E396', '#FEB019', '#FF4560', '#775DD0', '#546E7A', '#26a69a'],
        legend: {
            position: 'bottom'
        },
        tooltip: {
            y: {
                formatter: (value) => '₹' + value.toLocaleString('en-IN')
            }
        }
    };
    new ApexCharts(document.querySelector("#categoryChart"), categoryOptions).render();

    // Time Series Chart
    const updateTimeSeriesChart = (period) => {
        const data = timeBasedData[period];
        const dates = Object.keys(data);
        const revenues = dates.map(date => data[date].revenue);

        const timeSeriesOptions = {
            series: [{
                name: 'Revenue',
                data: revenues
            }],
            chart: {
                height: 400,
                type: 'line'
            },
            xaxis: {
                categories: dates
            },
            yaxis: {
                labels: {
                    formatter: (value) => '₹' + value.toLocaleString('en-IN')
                }
            }
        };

        document.querySelector("#timeSeriesChart").innerHTML = '';
        new ApexCharts(document.querySelector("#timeSeriesChart"), timeSeriesOptions).render();

        // Update current period statistics
        const currentPeriodData = data[currentPeriod[period]] || { revenue: 0, orders: 0, items: 0 };
        document.getElementById('currentPeriodRevenue').textContent = 
            '₹' + currentPeriodData.revenue.toLocaleString('en-IN');
        document.getElementById('currentPeriodOrders').textContent = 
            currentPeriodData.orders.toLocaleString('en-IN');
        document.getElementById('currentPeriodItems').textContent = 
            currentPeriodData.items.toLocaleString('en-IN');
        document.getElementById('periodLabel').textContent = 
            `Current ${period.charAt(0).toUpperCase() + period.slice(1)}`;
    };

    // Initialize with daily data
    updateTimeSeriesChart('daily');

    // Handle time range changes
    document.getElementById('timeRangeSelector').addEventListener('change', (e) => {
        updateTimeSeriesChart(e.target.value);
    });
});
</script>

<%- include('../layouts/adminFooter') %>